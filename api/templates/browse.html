{% load static %}
{% load bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>BingeList</title>
    <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}"/>
    <link
            rel="shortcut icon"
            type="image/png"
            href="{% static 'assets/BingeList_Icon.png' %}"
    />
</head>

<body>
<nav class="navbar nav-fill navbar-dark bg-primary">
    <div class="container-fluid">
        <div class="d-flex justify-content-start align-items-center">
            <button
                    class="navbar-toggler border-0"
                    type="button"
                    data-bs-toggle="offcanvas"
                    data-bs-target="#offcanvasNavbar"
                    aria-controls="offcanvasNavbar"
            >
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <img src="{% static 'assets/BingeList_Icon.png' %}"/>
                    </div>
                    <div class="ms-2 text-white fs-2 fw-bolder">BingeList</div>
                </div>
            </button>
        </div>
        <div
                class="offcanvas offcanvas-start bg-primary"
                tabindex="-1"
                id="offcanvasNavbar"
                aria-labelledby="offcanvasNavbarLabel"
        >
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Menu</h5>
                <button
                        type="button"
                        class="btn-close text-reset"
                        data-bs-dismiss="offcanvas"
                        aria-label="Close"
                ></button>
            </div>
            <div class="offcanvas-body">
                <ul class="navbar-nav justify-content-start">
                    <li class="nav-item text-start text-white text-center">
                        <a class="nav-link" href="{% url 'home' %}">Home</a>
                    </li>
                    <li class="nav-item">
                        <a
                                class="nav-link nav-fill nav-active bg-secondary text-start text-white text-center"
                                aria-current="page"
                                href="{% url 'browse' %}"
                        >Browse</a
                        >
                    </li>
                    <li class="nav-item text-start text-white text-center">
                        <a class="nav-link" href="{% url 'watchlist' %}">Watchlist</a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="d-flex justify-content-center align-items-center">
            <a class="navbar-brand fs-1" href="{% url 'browse' %}">Browse</a>
        </div>

        <div class="d-flex justify-content-end align-items-center">
            <form class="d-flex" action="{% url 'results' %}" method="get">
                <input
                        name="query"
                        class="form-control me-2 bg-secondary text-white"
                        type="search"
                        placeholder="Search"
                        aria-label="Search"
                />
                <button
                        class="btn btn-outline-light align-self-center"
                        type="submit"
                >
                    Search
                </button>
            </form>
        </div>
    </div>

    <div
            class="offcanvas offcanvas-start bg-primary"
            tabindex="-1"
            id="offcanvasNavbar"
            aria-labelledby="offcanvasNavbarLabel"
    >
        <div class="offcanvas-header">
            <h2 class="offcanvas-title" id="offcanvasNavbarLabel">Menu</h2>
            <button
                    type="button"
                    class="btn-close btn-close"
                    data-bs-dismiss="offcanvas"
                    aria-label="Close"
            ></button>
        </div>
        <div class="offcanvas-body">
            <ul class="navbar-nav nav-pills flex-column justify-content-end pe-3">
                <li class="nav-item">
                    <a
                            class="nav-link active bg-secondary"
                            aria-current="page"
                            href="{% url 'home' %}"
                    >Home</a
                    >
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'browse' %}">Browse</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'watchlist' %}">Watchlist</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        {% for movie in movies %}
            <div class="col-md-3 pt-3">
                <div
                        class="card border-primary"
                        id="movie{{ movie.id }}"
                        data-type="movie"
                        data-title="{{ movie.title }}"
                        data-description="{{ movie.overview }}"
                        data-release-date="{{ movie.release_date }}"
                >
                    <h5 class="card-header fs-6 bg-primary">{{ movie.title }}</h5>
                    <img
                            src="https://image.tmdb.org/t/p/w500/{{ movie.poster_path }}"
                            alt="{{ movie.title }}"
                    />
                </div>
            </div>
        {% endfor %} {% for tv_show in tv_shows %}
        <div class="col-md-3 pt-3">
            <div
                    class="card"
                    id="tv{{ tv_show.id }}"
                    data-type="tv"
                    data-title="{{ tv_show.name }}"
                    data-description="{{ tv_show.overview }}"
                    data-release-date="{{ tv_show.first_air_date }}"
            >
                <h5 class="card-header fs-6 bg-primary">{{ tv_show.name }}</h5>
                <img
                        src="https://image.tmdb.org/t/p/w500/{{ tv_show.poster_path }}"
                        alt="{{ tv_show.title }}"
                />
            </div>
        </div>
    {% endfor %}
    </div>
</div>

<!-- Modal -->
<div
        class="modal fade"
        id="movieModal"
        tabindex="-1"
        aria-labelledby="movieModalLabel"
        aria-hidden="true"
>
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-primary">
                <h5 class="modal-title" id="movieModalLabel"></h5>
                <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                ></button>
            </div>
            <div class="modal-body bg-secondary">
                <div class="row">
                    <div class="col-md-4">
                        <img src="" alt="" id="modalImage" style="width: 300px"/>
                    </div>
                    <div class="col-md-8">
                        <h2 id="modalTitle"></h2>
                        <p id="modalDescription"></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer bg-primary justify-content-between">
                <p id="modalReleaseDate" class="ms-3"></p>
                <div>
                    <form method="POST" action="">
                    {% csrf_token %}
                    <button type="button" class="btn btn-danger me-2" data-bs-dismiss="modal">
                        Close
                    </button>
                    <input type="hidden" name="movie_id" value="{{ movie.id }}">
                    <button type="submit" class="btn btn-primary">Add to Watchlist</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        $(document).ready(function () {
            $(".card").click(function () {
                var type = $(this).data("type");
                var title = $(this).data("title");
                var description = $(this).data("description");
                var releaseDate = $(this).data("release-date");
                var imageSrc = $(this).find("img").attr("src");

                $("#movieModalLabel").text(title);
                $("#modalDescription").text(description);
                $("#modalReleaseDate").text("Release date: " + releaseDate);
                $("#modalImage").attr("src", imageSrc);
                $("#addToWatchlistBtn").attr("data-type", type);
                $("#addToWatchlistBtn").attr("data-title", title);
                $("#addToWatchlistBtn").attr("data-description", description);
                $("#addToWatchlistBtn").attr("data-release-date", releaseDate);
                $("#addToWatchlistBtn").attr("data-image-url", imageSrc);

                $("#movieModal").modal("show");
            });
        });
    </script>
</div>
</body>
</html>
